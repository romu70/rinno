---
// Accordion component - content block with collapsible/expandable behavior
interface Props {
  title: string;
  defaultOpen?: boolean;
  id?: string;
  headingLevel?: "h2" | "h3" | "h4";
}

const { title, defaultOpen = false, id, headingLevel = "h4" } = Astro.props;
const sectionId =
  id || `collapsible-${Math.random().toString(36).substr(2, 9)}`;
const HeadingTag = headingLevel;
---

<section class="accordion" data-section-id={sectionId}>
  <button
    class="section-header"
    aria-expanded={defaultOpen}
    aria-controls={`${sectionId}-content`}
  >
    <svg class="chevron" viewBox="0 0 512 512" aria-hidden="true">
      <path
        d="M508.425,317.235c-78.541-56.107-147.746-123.725-205.687-200.96l-39.91-53.222c-3.217-4.301-10.436-4.301-13.653,0
        l-39.91,53.222C151.322,193.51,82.116,261.129,3.575,317.235C1.331,318.831,0,321.417,0,324.173v119.467
        c0,3.2,1.783,6.127,4.625,7.586c2.842,1.468,6.263,1.212,8.866-0.649l9.779-6.98c73.455-52.463,139.042-114.978,194.953-185.796
        L256,209.946l37.777,47.846c55.91,70.827,121.498,133.342,194.953,185.805l9.779,6.98c1.476,1.067,3.209,1.596,4.958,1.596
        c1.331,0,2.671-0.316,3.908-0.947c2.842-1.459,4.625-4.386,4.625-7.586V324.173C512,321.417,510.669,318.831,508.425,317.235z"
      ></path>
    </svg>
    <HeadingTag>{title}</HeadingTag>
  </button>
  <div
    class="section-content"
    id={`${sectionId}-content`}
    data-default-open={defaultOpen}
  >
    <div class="section-content-inner">
      <slot />
    </div>
  </div>
</section>

<style>
  .accordion {
    padding: 0;
    border-radius: var(--radius);
    transition:
      background-color 0.3s ease,
      padding 0.3s ease;
  }

  .accordion[data-expanded="true"] {
    background-color: hsla(var(--hue), 40%, 90%, 0.6);
    padding: 1.5rem;
  }

  .collapsible-section {
    background-color: transparent;
    border-radius: var(--radius);
  }

  .section-header {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 1rem;
    background: none;
    border: none;
    padding: 0;
    cursor: pointer;
    text-align: left;
  }

  .section-header h2,
  .section-header h3,
  .section-header h4 {
    margin: 0;
  }

  .chevron {
    width: 1rem;
    height: 1rem;
    transform: rotate(180deg);
    transition:
      transform 0.3s ease,
      fill 0.2s ease;
    flex-shrink: 0;
    fill: var(--color-dark);
  }

  .section-header:hover .chevron {
    fill: var(--color);
  }

  .section-header[aria-expanded="true"] .chevron {
    transform: rotate(0deg);
  }

  .section-content {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transition:
      max-height 0.4s ease,
      opacity 0.3s ease;
  }

  .section-content[data-default-open="true"] {
    max-height: 5000px;
    opacity: 1;
  }

  .section-content-inner {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  /* Columns get equal space, max 2 per row */
  .section-content-inner > :global(.column) {
    flex: 1 1 40%;
  }

  /* Non-column content takes full width */
  .section-content-inner > :global(:not(.column)) {
    flex: 1 1 100%;
  }

  @media (max-width: 768px) {
    .accordion[data-expanded="true"] {
      padding: 1rem;
    }

    /* Stack columns vertically on mobile */
    .section-content-inner > :global(.column) {
      flex: 1 1 100%;
    }

    .chevron {
      width: 1rem;
      height: 1rem;
    }

    .section-content,
    .section-content-inner {
      gap: 1rem;
    }
  }

  @media (min-width: 1440px) {
    .accordion[data-expanded="true"] {
      padding: 2rem;
    }

    .chevron {
      width: 1.1rem;
      height: 1.1rem;
    }

    .section-content,
    .section-content-inner {
      gap: 2rem;
    }
  }
</style>

<script>
  // Handle collapsible sections
  document.addEventListener("DOMContentLoaded", () => {
    const sections = document.querySelectorAll(".accordion");

    sections.forEach((section) => {
      const button = section.querySelector(".section-header") as HTMLElement;
      const content = section.querySelector(".section-content") as HTMLElement;

      if (!button || !content) return;

      button.addEventListener("click", () => {
        const isExpanded = button.getAttribute("aria-expanded") === "true";

        // Toggle aria-expanded
        button.setAttribute("aria-expanded", (!isExpanded).toString());

        // Toggle background on accordion wrapper
        if (isExpanded) {
          section.removeAttribute("data-expanded");
          content.style.maxHeight = "0";
          content.style.opacity = "0";
        } else {
          section.setAttribute("data-expanded", "true");
          content.style.maxHeight = "5000px";
          content.style.opacity = "1";
        }
      });
    });
  });
</script>
